<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>회사 인증 상세</title>
<link rel="stylesheet" href="/css/admin.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="certification-page-body">

	<h2>회사 인증 상세</h2>

	<table id="certification-info" class="certification-page-table">
		<!-- 인증 정보가 여기에 들어감 -->
	</table>

	<div class="certification-image-box">
		<img id="certification-image" src="" alt="인증 이미지">
	</div>

	<div class="certification-btns">
		<button id="reject-btn">반려</button>
		<button id="approve-btn">확인</button>
	</div>

	<div class="certification-status-message"
		style="display: none; margin-top: 20px; font-weight: bold;"></div>

	<script>
	$(function() {
	    const urlParams = new URLSearchParams(window.location.search);
	    const userId = urlParams.get("userId");

	    // UI를 업데이트하는 함수
	    function updateUI(data) {
	        // 인증 정보를 테이블에 표시
	        $('#certification-info').html(`
	            <tr><td>요청자</td><td>${data.nickname}</td></tr>
	            <tr><td>단체</td><td>${data.company}</td></tr>
	            <tr><td>날짜</td><td>${data.date}</td></tr>
	            <tr><td>상태</td><td id="status-cell">${data.state}</td></tr>
	        `);
	        $('#certification-image').attr('src', data.imageUrl);

	        // 상태 값에 따라 UI 변경
	        const status = data.state;
	        if (status === '완료') {
	            // 상태가 '완료'면 버튼 숨기고 메시지 표시
	            $('.certification-btns').hide();
	            $('.certification-status-message')
	                .text("인증이 승인된 유저입니다.")
	                .css("color", "green")
	                .show();
	        } else if (status === '반려') {
	            // 상태가 '반려'면 버튼 숨기고 메시지 표시
	            $('.certification-btns').hide();
	            $('.certification-status-message')
	                .text("인증이 반려된 유저입니다.")
	                .css("color", "red")
	                .show();
	        } else {
	            // 그 외의 경우 (예: '대기 중'), 버튼 표시
	            $('.certification-btns').show();
	            $('.certification-status-message').hide();
	        }
	    }

	    // 1. 페이지 로드 시, 서버에서 인증 정보를 가져와서 UI를 업데이트합니다.
	    $.get(`/admin/user/certification/${userId}/json`, updateUI);

	    // 2. '확인' 버튼 클릭 이벤트
	    $('#approve-btn').click(function () {
	    	$.post(`/admin/user/certifications/${userId}/status`, { status: '완료' }, function(response) {
	            // 요청 성공 후, 최신 데이터를 다시 가져와서 UI를 업데이트합니다.
	            $.get(`/admin/user/certification/${userId}/json`, updateUI);
	        });
	    });

	    // 3. '반려' 버튼 클릭 이벤트
	    $('#reject-btn').click(function () {
	    	$.post(`/admin/user/certifications/${userId}/status`, { status: '반려' }, function(response) {
	            // 요청 성공 후, 최신 데이터를 다시 가져와서 UI를 업데이트합니다.
	            $.get(`/admin/user/certification/${userId}/json`, updateUI);
	        });
	    });
	});
	</script>


</body>
</html>
