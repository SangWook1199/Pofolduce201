<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">
<head>
<meta charset="UTF-8">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<title>첨삭게시판 글쓰기</title>
<style>
	.ck.ck-editor__editable{
		min-height: 500px;
	}
	input::placeholder {
    	text-align: center;
	}
</style>
</head>
<div layout:fragment="content">
	<div class="row justify-content-center m-5">
		<div class="col-10">
			<div
				th:replace="fragments/html/board-header :: board-header('첨삭 게시판')"></div>

			<form th:action="@{/review/write/save}" method="post">
				<div class="m-1 row p-3 border rounded">
					<div class="col-10">
						<input type="text" class="form-control col-6 text-center m-1"
							id="title" name="title" placeholder="제목을 입력하세요" required>
						<input type="text" class="form-control m-1" id="portfolio" name="portfolioHtml" placeholder="pdf가 변환된 html이 자동으로 입력됩니다" readonly required>
					</div>
					<div class="col-2 d-flex justify-content-center ">
						<button type="button" class="btn btn-primary"
							onclick="openMyPofolList()">이력서 불러오기</button>
					</div>
				</div>
				<div class="my-2">
					<textarea class="form-control" id="editor" name="postHtml"
						rows="10"></textarea>
				</div>
				<div class="d-flex justify-content-between">
					<a th:href="@{/review-post}" class="btn btn-secondary">목록보기</a>
					<button type="submit" class="btn btn-primary">게시하기</button>
				</div>
			</form>
		</div>
	</div>
	<script
		src="https://cdn.ckeditor.com/ckeditor5/39.0.1/classic/ckeditor.js">
	</script>
	<script>
    ClassicEditor
        .create(document.querySelector('#editor'))
        .then(editor => {
            console.log("CKEditor 로드 완료");
            ckEditorInstance = editor;

            // 만약 기다리고 있던 데이터가 있다면 지금 바로 처리
/*             if (pendingData !== null) {
                ckEditorInstance.setData(pendingData);
                pendingData = null; // 처리 후 초기화
            } */
        })
        .catch(error => {
            console.error(error);
        });

	// 버튼 누르면 팝업 열기
	// 팝업 창에서 이력서 선택하는 페이지 표시
	// 팝업 페이지에서 이력서 선택하면 해당 이력서 상세 페이지로 이동
	// 이력서 상세 페이지로 이동 후 이력서 선택
	// fetch를 통해 컨트롤러에 접근하여 pdf를 html로 변환 후 javascript에 객체로 전송 -> 객체 전송 완료될때까지 modal로 화면에 로딩중 띄움.
	// 원래 페이지에 이력서 html 전달
	// 에디터에 추가
		function openMyPofolList(){
			
			const url = "/my-portfolio";
			const name="popup-test";
			const width = 700;
			const height = 800;
			const left = (window.screen.width / 2) - (width / 2);
			const top = (window.screen.height / 2) - (height / 2);
			const options = `width=${width},height=${height},top=${top},left=${left},scrollbars=yes,resizable=yes`;
			window.open(url, name, options);
		}
	
	function receivePortfolioFromPopup(portfolio){
		document.getElementById('portfolio').value = portfolio;
	}
	</script>
</div>
</html>
